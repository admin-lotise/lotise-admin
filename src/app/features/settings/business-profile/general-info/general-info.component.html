<div class="general-info-container">
  <!-- Success Message -->
  @if (successMessage()) {
    <div class="alert alert-success">
      <i class="fas fa-check-circle"></i>
      <span>{{ successMessage() }}</span>
      <button class="close-btn" (click)="successMessage.set(null)">
        <i class="fas fa-times"></i>
      </button>
    </div>
  }

  <!-- Error Message -->
  @if (errorMessage()) {
    <div class="alert alert-error">
      <i class="fas fa-exclamation-circle"></i>
      <span>{{ errorMessage() }}</span>
      <button class="close-btn" (click)="errorMessage.set(null)">
        <i class="fas fa-times"></i>
      </button>
    </div>
  }

  <div class="content-grid">
    <!-- LEFT SIDE: Form -->
    <div class="form-section">
      <form [formGroup]="generalInfoForm" (ngSubmit)="onSubmit()">
        <!-- Business Name -->
        <div class="form-group">
          <label for="businessName" class="form-label">
            <i class="fas fa-store"></i>
            Nombre del Negocio
            <span class="required">*</span>
          </label>
          <input
            type="text"
            id="businessName"
            formControlName="businessName"
            class="form-control"
            [class.is-invalid]="businessName?.invalid && businessName?.touched"
            placeholder="Ej: Rifas El Búfalo"
          />
          @if (businessName?.invalid && businessName?.touched) {
            <div class="error-message">
              @if (businessName?.errors?.['required']) {
                <span>El nombre del negocio es requerido</span>
              }
              @if (businessName?.errors?.['minlength']) {
                <span>Debe tener al menos 3 caracteres</span>
              }
              @if (businessName?.errors?.['maxlength']) {
                <span>No puede superar los 100 caracteres</span>
              }
            </div>
          }
          <small class="form-hint">
            Este nombre se mostrará en la página principal de rifas
          </small>
        </div>

        <!-- About Us -->
        <div class="form-group">
          <label for="aboutUs" class="form-label">
            <i class="fas fa-align-left"></i>
            Nosotros - Breve Descripción
            <span class="required">*</span>
          </label>
          <textarea
            id="aboutUs"
            formControlName="aboutUs"
            class="form-control textarea-large"
            [class.is-invalid]="aboutUs?.invalid && aboutUs?.touched"
            placeholder="Escribe una breve descripción de tu negocio, quiénes son, qué hacen, etc."
            rows="8"
          ></textarea>
          @if (aboutUs?.invalid && aboutUs?.touched) {
            <div class="error-message">
              @if (aboutUs?.errors?.['required']) {
                <span>La descripción es requerida</span>
              }
              @if (aboutUs?.errors?.['minlength']) {
                <span>Debe tener al menos 10 caracteres</span>
              }
              @if (aboutUs?.errors?.['maxlength']) {
                <span>No puede superar los 5000 caracteres</span>
              }
            </div>
          }
          <small class="form-hint">
            Caracteres: {{ aboutUs?.value?.length || 0 }} / 5000
          </small>
          <div class="info-box">
            <i class="fas fa-info-circle"></i>
            <span>
              Por ahora es un campo de texto simple. Próximamente se implementará un editor rico con formato, negritas, cursivas, etc.
            </span>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="form-actions">
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="generalInfoForm.invalid || isSaving()"
          >
            @if (isSaving()) {
              <i class="fas fa-spinner fa-spin"></i>
              <span>Guardando...</span>
            } @else {
              <i class="fas fa-save"></i>
              <span>Guardar Datos Generales</span>
            }
          </button>
        </div>
      </form>
    </div>

    <!-- RIGHT SIDE: Logo Upload -->
    <div class="logo-section">
      <div class="logo-card">
        <h3 class="logo-title">
          <i class="fas fa-image"></i>
          Logo del Negocio
        </h3>

        <!-- Current Logo -->
        @if (currentLogoUrl()) {
          <div class="logo-preview-container">
            <div class="logo-preview">
              <img [src]="currentLogoUrl()!" alt="Logo actual" />
            </div>
            <div class="logo-actions">
              <button
                type="button"
                class="btn btn-danger-outline btn-sm"
                (click)="removeLogo()"
              >
                <i class="fas fa-trash-alt"></i>
                Eliminar Logo
              </button>
            </div>
          </div>
        } @else {
          <div class="no-logo">
            <i class="fas fa-image"></i>
            <p>No hay logo configurado</p>
          </div>
        }

        <!-- Upload Section -->
        <div class="upload-section">
          <h4 class="upload-subtitle">Subir Nuevo Logo</h4>

          @if (previewUrl()) {
            <!-- Preview Selected File -->
            <div class="file-preview">
              <img [src]="previewUrl()!" alt="Preview" />
              <div class="preview-actions">
                <button
                  type="button"
                  class="btn btn-primary"
                  (click)="uploadLogo()"
                  [disabled]="isUploadingLogo()"
                >
                  @if (isUploadingLogo()) {
                    <i class="fas fa-spinner fa-spin"></i>
                    <span>Subiendo...</span>
                  } @else {
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span>Confirmar y Subir</span>
                  }
                </button>
                <button
                  type="button"
                  class="btn btn-secondary"
                  (click)="cancelFileSelection()"
                  [disabled]="isUploadingLogo()"
                >
                  <i class="fas fa-times"></i>
                  Cancelar
                </button>
              </div>
            </div>
          } @else {
            <!-- File Input -->
            <div class="file-input-wrapper">
              <input
                type="file"
                id="logoFile"
                class="file-input"
                accept="image/jpeg,image/png,image/webp"
                (change)="onFileSelected($event)"
              />
              <label for="logoFile" class="file-label">
                <i class="fas fa-cloud-upload-alt"></i>
                <span>Seleccionar Imagen</span>
              </label>
            </div>
          }

          <div class="upload-info">
            <ul>
              <li><i class="fas fa-check"></i> Formatos: JPG, PNG, WEBP</li>
              <li><i class="fas fa-check"></i> Tamaño máximo: 5MB</li>
              <li><i class="fas fa-check"></i> Recomendado: 300x300px</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>