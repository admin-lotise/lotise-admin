<div class="business-profile-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        Perfil del Negocio
      </h1>
      <p class="page-subtitle">
        Configura la información de tu negocio y tu página Bio
      </p>
    </div>
    
    @if (isLoading()) {
      <div class="reload-button loading">
        <i class="fas fa-spinner fa-spin"></i>
      </div>
    } @else {
      <button class="reload-button" (click)="reloadData()" title="Recargar datos">
        <i class="fas fa-sync-alt"></i>
      </button>
    }
  </div>

  <!-- Error Alert -->
  @if (error()) {
    <div class="alert alert-error">
      <i class="fas fa-exclamation-circle"></i>
      <span>{{ error() }}</span>
      <button class="close-btn" (click)="settingsState.clearBusinessProfileError()">
        <i class="fas fa-times"></i>
      </button>
    </div>
  }

  <!-- Loading State (Initial) -->
  @if (isInitialLoad() && isLoading()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Cargando información del perfil...</p>
    </div>
  } @else {
    <!-- Tabs Navigation -->
    <div class="tabs-container">
      <div class="tabs-header">
        
        <!-- ========== BUSINESS PROFILE TABS ========== -->
        <button 
          class="tab-button" 
          [class.active]="activeTab() === 'general'"
          (click)="changeTab('general')"
          title="Información general del negocio"
        >
          <i class="fas fa-info-circle"></i>
          <span>Datos Generales</span>
        </button>
        
        <button 
          class="tab-button" 
          [class.active]="activeTab() === 'contacts'"
          (click)="changeTab('contacts')"
          title="Números de WhatsApp"
        >
          <i class="fab fa-whatsapp"></i>
          <span>Contactos</span>
          @if (settingsState.whatsappContactsCount() > 0) {
            <span class="badge">{{ settingsState.whatsappContactsCount() }}</span>
          }
        </button>
        
        <button 
          class="tab-button" 
          [class.active]="activeTab() === 'social'"
          (click)="changeTab('social')"
          title="Redes sociales"
        >
          <i class="fas fa-share-alt"></i>
          <span>Redes Sociales</span>
          @if (settingsState.hasSocialMedia()) {
            <span class="badge-dot"></span>
          }
        </button>

        <!-- ========== BIO PAGE TABS ========== -->
        <button 
          class="tab-button" 
          [class.active]="activeTab() === 'bio-contact'"
          (click)="changeTab('bio-contact')"
          title="Información de contacto en Bio Page"
        >
          <i class="fas fa-address-book"></i>
          <span>Bio: Contacto</span>
          @if (bioPage().contact.enabled) {
            <span class="badge-dot"></span>
          }
        </button>

        <button 
          class="tab-button" 
          [class.active]="activeTab() === 'bio-how'"
          (click)="changeTab('bio-how')"
          title="Sección Cómo Funciona"
        >
          <i class="fas fa-list-ol"></i>
          <span>Bio: Cómo Funciona</span>
          @if (bioPage().howItWorks.enabled) {
            <span class="badge">{{ bioPage().howItWorks.steps.length }}</span>
          }
        </button>

        <button 
          class="tab-button" 
          [class.active]="activeTab() === 'bio-testimonials'"
          (click)="changeTab('bio-testimonials')"
          title="Testimonios de clientes"
        >
          <i class="fas fa-quote-left"></i>
          <span>Bio: Testimonios</span>
          @if (bioPage().testimonials.enabled) {
            <span class="badge">{{ bioPage().testimonials.items.length }}</span>
          }
        </button>

        <button 
          class="tab-button" 
          [class.active]="activeTab() === 'bio-faqs'"
          (click)="changeTab('bio-faqs')"
          title="Preguntas frecuentes"
        >
          <i class="fas fa-question-circle"></i>
          <span>Bio: FAQs</span>
          @if (bioPage().faqs.enabled) {
            <span class="badge">{{ bioPage().faqs.items.length }}</span>
          }
        </button>

        <button 
          class="tab-button" 
          [class.active]="activeTab() === 'bio-preview'"
          (click)="changeTab('bio-preview')"
          title="Vista previa de tu Bio Page"
        >
          <i class="fas fa-eye"></i>
          <span>Bio: Preview</span>
          @if (activeBioSectionsCount() > 0) {
            <span class="badge">{{ activeBioSectionsCount() }}</span>
          }
        </button>

      </div>

      <!-- Tab Content -->
      <div class="tab-content">
        @switch (activeTab()) {
          <!-- Business Profile -->
          @case ('general') {
            <app-general-info />
          }
          @case ('contacts') {
            <app-contact-numbers />
          }
          @case ('social') {
            <app-social-media />
          }
          <!-- Bio Page -->
          @case ('bio-contact') {
            <app-contact-info />
          }
          @case ('bio-how') {
            <app-how-it-works />
          }
          @case ('bio-testimonials') {
            <app-testimonials />
          }
          @case ('bio-faqs') {
            <app-faqs />
          }
          @case ('bio-preview') {
            <app-preview />
          }
        }
      </div>
    </div>
  }
</div>